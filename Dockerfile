# Dockerfile для сборки образа API приложения

# Базовый образ: Python 3.11 на slim-версии Debian
# Slim версия уменьшает размер образа за счет удаления ненужных пакетов
FROM python:3.11-slim

# Рабочая директория внутри контейнера
WORKDIR /app

# Копируем файл зависимостей и устанавливаем их
# Отдельный COPY для requirements.txt улучшает кеширование слоев Docker
COPY requirements.txt .

# Установка Python зависимостей:
# --no-cache-dir : не кешировать пакеты pip для уменьшения размера образа
RUN pip install --no-cache-dir -r requirements.txt

# Создание директории для данных (статьи, пользователи, загрузки)
# -p : создавать родительские директории если нужно
RUN mkdir -p /app/data

# Копирование исходного кода приложения:
# main.py : основной файл приложения FastAPI
# app/ : пакет с модулями приложения (auth.py, security.py, utils/)
# seeds.py : скрипт для начального наполнения данных
COPY main.py .
COPY app ./app
COPY seeds.py .

# Команда запуска приложения:
# uvicorn : ASGI-сервер для FastAPI
# --host 0.0.0.0 : слушать все сетевые интерфейсы
# --port 8000 : порт приложения
# --reload : автоматическая перезагрузка при изменении кода (для разработки)
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]




